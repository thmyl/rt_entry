import numpy as np
import matplotlib.pyplot as plt


# search width = 1
naive_width1_x = [43.31, 64.62, 75.20, 81.58, 85.51, 88.69, 90.82, 92.40, 93.57,
    94.54, 95.38, 96.02, 96.50, 97.02, 97.41, 97.63, 97.88, 98.08, 98.34,
    98.45, 98.57, 98.72, 98.92, 98.98, 99.07, 99.14, 99.14]
naive_width1_y = [2241700.105, 1374629.022, 991778.1591, 774551.3411, 635041.5952, 537550.5969,
    466407.0334, 411192.6643, 367387.7263, 331733.2732, 303218.6661, 278953.2558,
    258173.1154, 240208.501, 224025.3776, 210561.3355, 198247.8852, 187672.5414,
    177630.3052, 168951.4535, 160834.5383, 153527.0538, 146877.171, 136796.8471,
    135233.0878, 131386.19, 131379.6306]

naive_rt_width1_x = [45.63, 65.32, 76.16, 82.04, 86.09, 88.90, 90.88, 92.62, 93.69,
    94.68, 95.62, 96.13, 96.64, 97.09, 97.47, 97.67, 97.92, 98.15, 98.34,
    98.50, 98.57, 98.73, 98.93, 99.00, 99.08, 99.16, 99.16]
naive_rt_width1_y = [2406999.555, 1440154.385, 1015158.344, 789540.1718, 636116.1294,
    546863.4646, 472038.7827, 415777.9413, 371657.4062, 336030.5385, 306114.6399,
    280943.859, 260068.5541, 241510.3089, 225954.9988, 211760.7696, 199456.2822,
    188311.5049, 178362.4897, 169386.7353, 161541.4935, 154215.7972, 147363.3021,
    141398.1163, 135754.1005, 132160.628, 132245.0448]

pca64_width1_x = [43.03, 64.80, 76.13, 82.78, 87.06, 89.92, 91.76, 93.14, 94.31,
    95.17, 95.82, 96.36, 96.91, 97.29, 97.60, 97.98, 98.18, 98.36, 98.47,
    98.64, 98.72, 98.82, 98.94, 99.04, 99.14, 99.20, 99.20]
pca64_width1_y = [11385890.6, 8631181.004, 6942034.016, 5777808.593, 4927419.116,
    4346900.008, 3850018.673, 3456356.585, 3140259.699, 2887978.213, 2647624.948,
    2459776.505, 2289146.698, 2140191.076, 2011716.235, 1901748.087, 1813657.567,
    1690451.317, 1610887.019, 1543364.689, 1474589.143, 1427910.51, 1363166.691,
    1261313.986, 1247088.049, 1222984.277, 1220735.908]

pca64_rt_width1_x = [47.58, 66.88, 77.62, 83.53, 87.48, 90.06, 91.76, 93.25, 94.38,
    95.14, 95.83, 96.43, 96.96, 97.28, 97.69, 97.99, 98.20, 98.35, 98.50,
    98.64, 98.71, 98.80, 98.97, 99.05, 99.14, 99.20, 99.20]
pca64_rt_width1_y = [12184274.97, 8707918.982, 7121746.252, 5893342.291, 5068577.858,
    4339618.548, 3826140.19, 3423414.788, 3176670.532, 2889714.063, 2674740.818,
    2474977.973, 2313668.692, 2169159.754, 2039671.613, 1909880.384, 1815026.971,
    1724586.918, 1647910.696, 1552927.657, 1457570.842, 1416872.113, 1341503.987,
    1306472.264, 1260687.478, 1217230.63, 1228504.247]

# search width = 4
naive_width4_x = [60.92, 71.72, 78.53, 82.88, 85.96, 88.62, 90.43, 91.77, 92.72,
    93.70, 94.52, 95.20, 95.75, 96.20, 96.60, 96.99, 97.33, 97.62, 97.76,
    97.95, 98.10, 98.34, 98.41, 98.53, 98.64, 98.76, 98.87]
naive_width4_y = [1182824.443, 941752.6016, 778907.1932, 665583.9834, 581084.5362,
    514641.5522, 462081.5851, 419371.6136, 383653.3002, 353184.6661, 327282.9623,
    304645.8492, 285326.242, 267830.1207, 252772.28, 238935.4946, 226784.1106,
    215312.138, 205218.2907, 196013.8621, 187805.0659, 179565.1292, 172767.6689,
    166225.0621, 160036.8725, 154358.8627, 149070.397]

naive_rt_width4_x = [63.68, 73.77, 79.58, 83.45, 86.35, 88.69, 90.51, 91.76, 93.03,
    93.73, 94.59, 95.38, 95.83, 96.31, 96.68, 97.09, 97.37, 97.64, 97.84,
    98.05, 98.21, 98.36, 98.48, 98.59, 98.69, 98.81, 98.95]
naive_rt_width4_y = [1301718.92, 1016677.579, 829132.3959, 698963.4372, 606031.2227,
    535894.1931, 476374.2205, 430872.9054, 392868.6483, 361616.5707, 334404.5426,
    310215.0721, 290564.2176, 272953.3277, 256885.8245, 241949.1423, 229838.0331,
    217293.0501, 207702.0058, 191647.2464, 190142.2644, 181349.6403, 174690.4921,
    167130.733, 161330.1347, 155615.6232, 146652.2947]

pca64_width4_x = [60.87, 72.29, 79.17, 83.93, 86.96, 89.40, 91.20, 92.46, 93.48,
    94.24, 94.96, 95.51, 96.10, 96.43, 96.91, 97.28, 97.49, 97.76, 98.03,
    98.19, 98.33, 98.46, 98.56, 98.66, 98.71, 98.81, 98.91]
pca64_width4_y = [7819647.647, 6586357.02, 5690256.574, 5142604.421, 4598716.038,
    4102513.61, 3674120.232, 3477377.918, 3225920.92, 3012955.71, 2822817.398,
    2665429.907, 2508510.121, 2378438.032, 2258085.64, 2139042.009, 2056314.221,
    1939126.927, 1873171.317, 1822443.021, 1736753.348, 1654681.259, 1611936.064,
    1530823.905, 1493368.696, 1440214.534, 1391377.909]

pca64_rt_width4_x = [66.82, 75.38, 81.56, 85.06, 87.93, 90.10, 91.60, 92.80, 93.79,
    94.54, 95.20, 95.80, 96.25, 96.71, 97.12, 97.36, 97.60, 97.87, 98.02,
    98.23, 98.35, 98.48, 98.61, 98.70, 98.76, 98.85, 98.99]
pca64_rt_width4_y = [8385462.961, 7072886.091, 6053855.095, 5342765.095, 4757170.245,
    4180322.386, 3890914.326, 3538595.461, 3333277.779, 3073282.419, 2862966.95,
    2699419.625, 2523888.606, 2413057.537, 2285902.383, 2138762.94, 2056314.221,
    1939126.927, 1873171.317, 1822443.021, 1736753.348, 1654681.259, 1611936.064,
    1530823.905, 1493368.696, 1440214.534, 1391377.909]


ggnn_x = [74.87, 79.59, 82.45, 84.64, 86.41, 87.74, 88.98, 89.90, 90.60, 91.72, 92.91, 94.03, 95.08, 96.10, 97.11, 97.87, 98.15, 98.69, 98.99, 99.26]
ggnn_y = [452541.928, 398488.93, 336151.4026, 248143.268, 234395.1433, 215223.1649, 179752.6603, 168048.5862, 155103.6868, 136901.5349, 120242.4569, 96156.6199, 75357.95026, 66294.53335, 53108.43681, 39102.67189, 35101.02074, 26558.80252, 20539.78556, 17594.45141]


ganns_x = [60.33, 72.55, 79.89, 84.40, 87.89, 90.28, 91.95, 93.26,
    94.26, 95.30, 95.92, 96.43, 96.81, 97.29, 97.59, 97.79, 98.01,
    98.28, 98.39, 98.52, 98.66, 98.88, 98.98, 99.04, 99.12, 99.13]
ganns_y = [896700.1435, 693096.7563, 576335.6579, 486546.9761,
    422350.8046, 373426.939, 335244.2254, 302681.7604, 276678.7483,
    254725.1516, 235943.6567, 219120.4505, 205710.5242, 193633.3359,
    182242.3094, 172768.2659, 164015.0894, 155685.6396, 148586.2023,
    141997.0465, 135969.3253, 130481.8695, 125576.0803, 120497.8973,
    116569.1372, 116131.8794]




# 放入列表，便于遍历
all_groups = [
    # (naive_width1_x, naive_width1_y),
    # (naive_rt_width1_x, naive_rt_width1_y),
    # (pca64_width1_x, pca64_width1_y),
    # (pca64_rt_width1_x, pca64_rt_width1_y),
    (naive_width4_x, naive_width4_y),
    (naive_rt_width4_x, naive_rt_width4_y),
    (pca64_width4_x, pca64_width4_y),
    (pca64_rt_width4_x, pca64_rt_width4_y),
    (ggnn_x, ggnn_y),
    (ganns_x, ganns_y),
]

plt.figure(figsize=(8, 6))

for i, (x, y) in enumerate(all_groups):
    x = np.array(x)
    y = np.array(y)
    
    # 过滤掉 <= 0 的 y 值，避免 log10 出错
    mask = y > 0
    x = x[mask]
    y = y[mask]
    
    y_log = np.log10(y)
    plt.plot(x, y_log, marker='o', label=f'Group {i+1}')

plt.xlabel('Recall')
plt.ylabel('log10(QPS)')
plt.title('SIFT1M')
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.show()
plt.savefig("./img/gist.png", format="png", bbox_inches="tight")
print("图像已保存到文件：./img/gist.png")
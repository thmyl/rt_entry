import numpy as np
import matplotlib.pyplot as plt


# search width = 1
pca64_width1_x = [46.27, 70.08, 79.68, 84.81, 88.02, 90.23, 91.78, 92.96, 93.92, 94.67, 95.22, 95.75, 96.53, 97.09, 97.46, 97.77, 98.01, 98.22]
pca64_width1_y = [1273843.159, 931792.7693, 731405.8352, 606818.2094, 515793.6, 450152.3766, 398393.6767, 358349.7278, 324912.6797, 297290.789, 273719.1313, 253550.9815, 222004.1648, 196473.6902, 176356.5789, 159958.2829, 146309.8462, 134617.2227]

pca64_rt_width1_x = [52.69, 72.20, 80.75, 85.40, 88.35, 90.47, 91.95, 93.08, 94.04, 94.73, 95.29, 95.80, 96.56, 97.12, 97.49, 97.80, 98.04, 98.25]
pca64_rt_width1_y = [1312816.635, 961057.9326, 749114.1725, 616177.1139, 525942.0938, 457075.9935, 404228.2273, 361887.4602, 328487.0543, 300644.2807, 276171.3809, 255670.1242, 223314.4781, 197116.9672, 177415.6921, 160758.7814, 147171.5829, 135403.5636]


# search_width = 4
pca64_width4_x = [57.66, 72.10, 79.79, 83.99, 87.01, 89.07, 90.66, 91.77, 92.80, 93.56, 94.26, 94.77, 95.23, 95.61, 96.01, 96.34, 96.59, 96.83, 97.62, 98.11, 98.45, 98.67, 98.84, 98.94]
pca64_width4_y = [1068919.664, 908471.4967, 785138.8911, 693726.6301, 620482.1146, 564471.0624, 514101.8127, 476751.2264, 438900.6417, 410019.2299, 382973.0196, 360182.5405, 339762.7776, 321967.8676, 305054.7573, 290772.9035, 276258.3568, 264465.6076, 215074.1145, 181753.7419, 156388.7951, 137839.585, 123367.0825, 111157.1796]

pca64_rt_width4_x = [66.92, 76.38, 82.23, 85.55, 88.12, 89.81, 91.17, 92.21, 93.17, 93.85, 94.48, 94.96, 95.41, 95.81, 96.17, 96.44, 96.72, 96.94, 97.69, 98.16, 98.49, 98.69, 98.85, 98.96]
pca64_rt_width4_y = [1136313.277, 955438.3551, 819907.3505, 723908.5269, 643434.3954, 582974.8038, 530233.9392, 487831.0543, 450387.5585, 418834.1333, 391921.7097, 367543.0117, 345154.8883, 327121.2998, 309592.7308, 294859.1311, 280147.3575, 267191.7876, 217482.0795, 183105.5805, 158070.0282, 139032.7492, 123717.9725, 111692.1585]

# ggnn_x = [69.51, 73.61, 78.34, 83.73, 87.36, 89.63, 90.74, 91.74, 92.65, 94.20, 95.69, 96.68, 97.38, 98.06, 98.66, 99.02, 99.25, 99.55]
# ggnn_y = [1000000.0, 995024.8756, 980392.1569, 909090.9091, 833333.3333, 757575.7576,
#     729927.0073, 689655.1724, 662708.0903, 598802.3952, 555555.5556, 520833.3333,
#     471504.6184, 407051.7648, 370148.2814, 333658.0939, 319626.676, 275492.7187]

# ganns_x = [76.71, 84.04, 88.41, 91.25, 93.23, 94.56, 95.60, 96.40, 97.03,
#     97.55, 97.93, 98.23, 98.48, 98.67, 98.82, 98.95, 99.08, 99.17,
#     99.26, 99.34, 99.41, 99.46, 99.53, 99.56, 99.56, 99.56, 99.56]
# ganns_y = [1217581.882, 1103996.467, 1009081.736, 926097.4254, 869489.6096, 816459.8302,
#     756715.8532, 712149.2665, 668627.9754, 635889.6096, 601829.5619, 570874.0081,
#     546866.4552, 522848.4785, 501932.4399, 482905.1574, 463456.4583, 441579.0868,
#     423137.1387, 410812.5873, 398247.7101, 383273.9259, 365871.5059, 360295.4423,
#     366327.2035, 363940.7504, 365003.4675]



# 放入列表，便于遍历
all_groups = [
    # (naive_width1_x, naive_width1_y),
    # (naive_rt_width1_x, naive_rt_width1_y),
    (pca64_width1_x, pca64_width1_y),
    (pca64_rt_width1_x, pca64_rt_width1_y),
    # (naive_width4_x, naive_width4_y),
    # (naive_rt_width4_x, naive_rt_width4_y),
    (pca64_width4_x, pca64_width4_y),
    (pca64_rt_width4_x, pca64_rt_width4_y),
    # (ggnn_x, ggnn_y),
    # (ganns_x, ganns_y),
]

plt.figure(figsize=(8, 6))

for i, (x, y) in enumerate(all_groups):
    x = np.array(x)
    y = np.array(y)
    
    # 过滤掉 <= 0 的 y 值，避免 log10 出错
    mask = y > 0
    x = x[mask]
    y = y[mask]
    
    y_log = np.log10(y)
    plt.plot(x, y_log, marker='o', label=f'Group {i+1}')

plt.xlabel('Recall')
plt.ylabel('log10(QPS)')
plt.title('SIFT1M')
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.show()
plt.savefig("./img/sift100M.png", format="png", bbox_inches="tight")
print("图像已保存到文件：./img/sift100M.png")